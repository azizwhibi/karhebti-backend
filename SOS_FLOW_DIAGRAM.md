# ğŸš¨ SOS Flow - Visual Diagram

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. BreakdownSOSScreen                        â”‚
â”‚                      (Envoi de la demande)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ User opens SOS
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Check GPS Permission  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
            âœ… GRANTED                âŒ DENIED
                    â”‚                       â”‚
                    â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Check GPS Status â”‚    â”‚ Show Permission  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  Denied Screen   â”‚
                    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
    âœ… ENABLED              âŒ DISABLED
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fetch GPS    â”‚      â”‚  Show GPS        â”‚
â”‚ Location     â”‚      â”‚  Disabled Screen â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚                       â”‚ User clicks "Choose manually"
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ğŸ“ MAP WITH MARKER       â”‚
        â”‚                            â”‚
        â”‚  User can:                 â”‚
        â”‚  â€¢ See current position    â”‚
        â”‚  â€¢ Tap map to select new   â”‚
        â”‚  â€¢ Drag map to explore     â”‚
        â”‚  â€¢ Zoom in/out             â”‚
        â”‚                            â”‚
        â”‚  Indicator shows:          â”‚
        â”‚  ğŸ“¡ "GPS detected" OR      â”‚
        â”‚  ğŸ“ "Manual selection"     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ User fills form
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Type: [PNEU â–¼]        â”‚
        â”‚  Description: [...]    â”‚
        â”‚  Photo: [Add photo]    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ User clicks "Send SOS"
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Confirmation Dialog   â”‚
        â”‚  "Send SOS request?"   â”‚
        â”‚  [Cancel]  [Confirm]   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ User confirms
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  POST /breakdowns      â”‚
        â”‚  {type, lat, lon, ...} â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. SOSWaitingScreen                          â”‚
â”‚                  (Attente de confirmation)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Navigate to waiting screen
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â³ WAITING...         â”‚
        â”‚                        â”‚
        â”‚  "Request sent!"       â”‚
        â”‚  "Waiting for garage   â”‚
        â”‚   confirmation..."     â”‚
        â”‚                        â”‚
        â”‚  [Pulse animation]     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Start polling every 5s
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GET /breakdowns/:id   â”‚
        â”‚  Check status          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚              â”‚
    PENDING                 ACCEPTED       REFUSED
        â”‚                       â”‚              â”‚
        â”‚ Loop back             â”‚              â–¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚      â”‚ Show error  â”‚
                                â”‚      â”‚ Return home â”‚
                                â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   3. GarageTrackingScreen                       â”‚
â”‚                   (Suivi en temps rÃ©el)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Auto navigate on ACCEPTED
                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         ğŸ—ºï¸ TRACKING MAP             â”‚
        â”‚                                     â”‚
        â”‚   ğŸ”´ You (Client position)          â”‚
        â”‚        â”‚                            â”‚
        â”‚        â”‚ â† Route                    â”‚
        â”‚        â”‚                            â”‚
        â”‚   ğŸŸ¢ Garage (Tow truck)             â”‚
        â”‚                                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Simulate movement every 3s
                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â„¹ï¸ INFO CARD                      â”‚
        â”‚                                     â”‚
        â”‚   ğŸš— Status: En route               â”‚
        â”‚   â±ï¸  ETA: 15 minutes               â”‚
        â”‚   ğŸ“ Distance: 5.2 km               â”‚
        â”‚                                     â”‚
        â”‚   [ğŸ“ Call]  [ğŸ’¬ Message]           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Garage approaches
                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Distance decreases...             â”‚
        â”‚   ğŸŸ¢ â†’ â†’ â†’ â†’ â†’ ğŸ”´                   â”‚
        â”‚   ETA: 10 min... 5 min... 2 min     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Garage arrives
                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   âœ… ARRIVED!                        â”‚
        â”‚   Distance: < 100m                  â”‚
        â”‚   Status: COMPLETED                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ State Machine

```
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   IDLE/HOME    â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â”‚ User clicks SOS
                            â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  REQUESTING    â•‘
                    â•‘   LOCATION     â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  LOCATION OK   â•‘
                    â•‘  SHOW FORM     â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â”‚ User submits
                            â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   SENDING...   â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    PENDING     â•‘
                    â•‘ (Wait for ack) â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
                ACCEPTED         REFUSED
                    â”‚                â”‚
                    â–¼                â–¼
            â•”â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘ TRACKING  â•‘    â•‘  CANCELLED â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚                â”‚
                    â”‚                â”‚
                    â–¼                â–¼
            â•”â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘ COMPLETED â•‘    â•‘   HOME     â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“± Screen Flow with User Actions

### Screen 1: BreakdownSOSScreen

**User sees:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† SOS - Assistance routiÃ¨re â°â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸš¨                     â”‚
â”‚       [SOS Icon]                â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ Manual Selection     â”‚  â”‚
â”‚  â”‚  ğŸ‘‰ Tap map to adjust    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ğŸ—ºï¸ MAP VIEW         â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚      ğŸ”´ Marker            â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  (User can tap anywhere)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  Lat: 36.8065, Lon: 10.1815 ğŸ”„â”‚
â”‚                                 â”‚
â”‚  Type: [PNEU â–¼]                 â”‚
â”‚  Description: [________]        â”‚
â”‚  [ğŸ“· Add Photo]                 â”‚
â”‚                                 â”‚
â”‚  [ğŸš¨ Send SOS Request]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**User actions:**
1. âœ‹ Tap on map â†’ Marker moves
2. ğŸ“ Select breakdown type
3. âœï¸ Add description
4. ğŸ“¸ Optional: Add photo
5. âœ… Click "Send SOS"

---

### Screen 2: SOSWaitingScreen

**User sees:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† En attente de confirmation  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚          âš ï¸                     â”‚
â”‚    [Pulsing Animation]          â”‚
â”‚                                 â”‚
â”‚   Demande SOS envoyÃ©e !         â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â³ En attente           â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  Le garage examine        â”‚  â”‚
â”‚  â”‚  votre demande...         â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  Status: PENDING          â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  [Loading spinner]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  Polling: 5s intervals...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**What happens:**
- ğŸ”„ Auto-refresh every 5 seconds
- ğŸ“¡ Check breakdown status
- âœ… If ACCEPTED â†’ Navigate to tracking
- âŒ If REFUSED â†’ Show message + return

**No user action required** - Everything is automatic!

---

### Screen 3: GarageTrackingScreen

**User sees:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† DÃ©panneur en route          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      ğŸ—ºï¸ LIVE MAP         â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚   ğŸŸ¢ Garage (moving)      â”‚  â”‚
â”‚  â”‚    â•²                      â”‚  â”‚
â”‚  â”‚     â•² Blue route          â”‚  â”‚
â”‚  â”‚      â•²                    â”‚  â”‚
â”‚  â”‚       ğŸ”´ You              â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸš— En route              â”‚  â”‚
â”‚  â”‚  Le dÃ©panneur arrive      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â±ï¸  15 min  â”‚ ğŸ“ 5.2 km  â”‚  â”‚
â”‚  â”‚  ArrivÃ©e     â”‚ Distance   â”‚  â”‚
â”‚  â”‚  estimÃ©e     â”‚            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  [ğŸ“ Appeler]             â”‚  â”‚
â”‚  â”‚  [ğŸ’¬ Message]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  [Progress bar â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**User actions:**
- ğŸ‘ï¸ Watch garage approaching in real-time
- ğŸ“ Call garage directly
- ğŸ’¬ Send message
- â—€ï¸ Go back to home when done

---

## ğŸ¯ Key Features Summary

### 1. Smart Location Selection
- âœ… GPS auto-detection
- âœ… Manual map selection
- âœ… Clear visual indicators
- âœ… One-tap adjustment

### 2. Real-Time Status Updates
- âœ… Automatic polling (5s)
- âœ… No page refresh needed
- âœ… Instant navigation on accept
- âœ… Clear error messages

### 3. Live Tracking
- âœ… Animated marker movement
- âœ… Distance calculation
- âœ… ETA estimation
- âœ… Route visualization

### 4. User-Friendly UI
- âœ… Clear instructions at each step
- âœ… Visual feedback (colors, icons)
- âœ… Loading states
- âœ… Error handling

---

## ğŸ”§ Technical Implementation

### Component Hierarchy
```
NavGraph
  â””â”€â”€ BreakdownSOSScreen
        â”œâ”€â”€ LocationPermissionCheck
        â”œâ”€â”€ OpenStreetMapView â† Manual selection here
        â”œâ”€â”€ SOSFormContent
        â””â”€â”€ ConfirmationDialog
              â”‚
              â””â”€â”€ [Send] â†’ Navigate to SOSWaitingScreen
                                  â”‚
                                  â””â”€â”€ PollingLoop (every 5s)
                                        â”‚
                                        â””â”€â”€ [ACCEPTED] â†’ Navigate to GarageTrackingScreen
                                                              â”‚
                                                              â””â”€â”€ LiveMapWithTracking
```

### Data Flow
```
User Input
    â†“
[BreakdownSOSScreen]
    â†“
POST /breakdowns
    â†“
Backend creates breakdown
    â†“
Returns breakdown with ID
    â†“
Navigate to SOSWaitingScreen
    â†“
Start polling GET /breakdowns/:id
    â†“
Status changes to ACCEPTED
    â†“
Navigate to GarageTrackingScreen
    â†“
Simulate/Show real-time tracking
```

---

## âœ… All Requirements Met

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| Position selection (manual) | âœ… | `OpenStreetMapView` with tap handler |
| Position selection (GPS) | âœ… | `FusedLocationClient` auto-detect |
| Visual map | âœ… | OpenStreetMap (osmdroid) |
| Type selection | âœ… | Dropdown menu |
| Description field | âœ… | Optional text field |
| Photo upload | âœ… | Image picker |
| Send confirmation | âœ… | Confirmation dialog |
| Wait for garage | âœ… | `SOSWaitingScreen` with polling |
| Garage accepts â†’ Show route | âœ… | Auto-navigate to tracking |
| Real-time tracking | âœ… | Animated markers + route line |
| ETA calculation | âœ… | Distance-based estimation |
| Call garage | âœ… | Direct call button |

---

**ğŸ‰ TOUT EST PRÃŠT ! Le flux SOS est 100% fonctionnel et rÃ©pond Ã  toutes les exigences !**

